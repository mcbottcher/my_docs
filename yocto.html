<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yocto &mdash; MyDocs 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=e031e9a9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="U-Boot" href="uboot.html" />
    <link rel="prev" title="PyTest" href="pytest.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MyDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="github_actions.html">GitHub Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytest.html">PyTest</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Yocto</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nomenclature">Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bitbake-commands">Bitbake Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-custom-c-program-application">Adding a custom C program/application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#appending-to-a-recipe">Appending to a Recipe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tasks-adding-custom-tasks">Tasks / Adding Custom Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-groups">Package Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-package-group">Adding a package group</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#making-your-own-distro">Making your own Distro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#systemd">SystemD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-service">Adding a Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#patch-files">Patch Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#patching-device-tree">Patching Device Tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#editing-bitbake-files">Editing Bitbake Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assigning-values">Assigning Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-packages">Adding Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#include-and-require">Include and Require</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avoiding-recipe-name-clashes">Avoiding recipe name clashes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-python">Using Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optomising-image-size">Optomising Image Size</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-sdk">Creating an SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recipe-naming">Recipe Naming</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-bitbake-syntax">Updating Bitbake Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="uboot.html">U-Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="systemd.html">SystemD</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">üêç Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_commands.html">Linux Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="bash.html">Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="jinja.html">ü•∑ Jinja</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MyDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Yocto</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/yocto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="yocto">
<h1>Yocto<a class="headerlink" href="#yocto" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>Yocto is a framework for building customised embedded linux images for a device.</p>
<hr class="docutils" />
<section id="nomenclature">
<h2>Nomenclature<a class="headerlink" href="#nomenclature" title="Permalink to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>Bitbake: a generic task executor</p></li>
<li><p>OpenEmbedded: a metadata set used by bitbake</p></li>
<li><p>Metadata: files containing information about how to build an image</p></li>
<li><p>Recipe: file with instructions to build one or more packages</p></li>
<li><p>Layer: directory containing grouped meta-data</p></li>
<li><p>BSP: board support package, layer that deefines how to build for a board</p></li>
<li><p>Distribution: specific implementation of Linux, kernel version, rootfs etc.</p></li>
<li><p>Machine: defines the architecture, pins, buses, BSP etc.</p></li>
<li><p>Image: output of build process (bootable and executable Linux OS)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="bitbake-commands">
<h2>Bitbake Commands<a class="headerlink" href="#bitbake-commands" title="Permalink to this heading">ÔÉÅ</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before running a lot of these commands, you might have to source the environment. e.g. <code class="code highlight bash docutils literal highlight-bash"><span class="nb">source</span><span class="w"> </span>poky/oe-init-build-env<span class="w"> </span>&lt;build_dir&gt;</code></p>
</div>
<ul>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>&lt;image-name&gt;</code></p>
<blockquote>
<div><ul class="simple">
<li><p>This will build your linux image using the &lt;image-name&gt; as the root .bb file.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake-layers<span class="w"> </span>create-layer<span class="w"> </span>meta-&lt;name&gt;</code></p>
<blockquote>
<div><ul class="simple">
<li><p>This creates the basic directory structure for a layer. The name should start with <em>meta</em>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-c<span class="w"> </span>&lt;cmd&gt;<span class="w"> </span>&lt;image&gt;</code></p>
<blockquote>
<div><ul class="simple">
<li><p>Run a command from an image. The command is a task available to the image.</p></li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-c<span class="w"> </span>cleanall<span class="w"> </span>my_image</code></p></li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-c<span class="w"> </span>clean<span class="w"> </span>my_image</code></p></li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-c<span class="w"> </span>compile<span class="w"> </span>my_image</code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-e</code></p>
<blockquote>
<div><ul class="simple">
<li><p>Shows the bitbake environment for the most recent build</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-g<span class="w"> </span>&lt;package_name&gt;</code></p>
<blockquote>
<div><ul class="simple">
<li><p>Creates a dependancy tree for the package, which you can view in <em>task-depends.dot</em></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash"><span class="nv">BBDEBUG</span><span class="o">=</span><span class="m">3</span><span class="w"> </span>bitbake<span class="w"> </span>custom-image</code></p>
<blockquote>
<div><ul class="simple">
<li><p>Prints debug information from your build</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="code highlight bash docutils literal highlight-bash">bitbake<span class="w"> </span>-c<span class="w"> </span>devshell<span class="w"> </span>&lt;target&gt;</code></p>
<blockquote>
<div><ul class="simple">
<li><p>This is a shell where you can run bitbake commands, and see environment variables like <code class="docutils literal notranslate"><span class="pre">$CC</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="adding-a-custom-c-program-application">
<h2>Adding a custom C program/application<a class="headerlink" href="#adding-a-custom-c-program-application" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This section will describe adding a program (C) to <em>usr/bin</em></p>
<dl class="simple">
<dt>Tutorials:</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/joaocfernandes/Learn-Yocto/blob/master/develop/Recipe-c.md">Basic C program</a></p></li>
<li><p><a class="reference external" href="https://github.com/joaocfernandes/Learn-Yocto/blob/master/develop/Recipe-CMake.md">Using CMake</a></p></li>
</ol>
</dd>
</dl>
<p>You will want something similar to this in your <em>CMakeLists.txt</em>, which installs the program in <em>usr/bin</em></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">1.9</span><span class="p">)</span>
<span class="nb">project</span><span class="w"> </span><span class="p">(</span><span class="s">hellocmake</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">hellocmake</span><span class="w"> </span><span class="s">helloworld.c</span><span class="p">)</span>
<span class="nb">install</span><span class="p">(</span><span class="s">TARGETS</span><span class="w"> </span><span class="s">hellocmake</span><span class="w"> </span><span class="s">RUNTIME</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">bin</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want pull files from GitHub for example, you something like in the example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SRCREV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AUTOREV</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">PV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1+git</span><span class="si">${</span><span class="nv">SRCPV</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">SRC_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;git://github.com/mcbemlogic/yocto_pull_test;protocol=http;branch=main&quot;</span>
<span class="nv">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">WORKDIR</span><span class="si">}</span><span class="s2">/git&quot;</span>
inherit<span class="w"> </span>cmake
<span class="nv">EXTRA_OECMAKE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-fetching.html#git-fetcher-git">Pulling files from GitHub</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOREV</span></code> will pull the latest commit from git. You can use this revision to update the package name too.</p></li>
<li><p>You can also pull specific commits with something like: <code class="docutils literal notranslate"><span class="pre">SRCREV</span> <span class="pre">=</span> <span class="pre">&quot;01351f639907247a2ecd2309865dffcd11930d8f&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">cmake</span></code> is required if your package is using CMake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTRA_OECMAKE</span></code> allows you to pass extra arguments to the CMake process</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="appending-to-a-recipe">
<h2>Appending to a Recipe<a class="headerlink" href="#appending-to-a-recipe" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This is achieved using the <em>.bbappend</em> where the name of the file is the same
as the recipe file you want to append to.</p>
<p>The append file can overwrite or add new things to an existing <em>.bb</em> file.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">%</span></code> in the name so that it disregards the version number of the <em>.bb</em> file.</p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">hello_0.1.bb</span></code> can be appended with both <code class="docutils literal notranslate"><span class="pre">hello_%.bbappend</span></code> and <code class="docutils literal notranslate"><span class="pre">hello_0.1.bbappend</span></code></p>
</section>
<section id="tasks-adding-custom-tasks">
<h2>Tasks / Adding Custom Tasks<a class="headerlink" href="#tasks-adding-custom-tasks" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>You can write a task in a <em>.bb</em> file with either regular or python syntax:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Regular syntax</span><a class="headerlink" href="#id1" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">do_custom_task</span><span class="p">(){</span>
<span class="n">echo</span> <span class="s2">&quot;CUSTOM TASK is running!&quot;</span>
<span class="p">}</span>

<span class="n">addtask</span> <span class="n">custom_task</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Python syntax</span><a class="headerlink" href="#id2" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">do_custom_task</span><span class="p">(){</span>
   <span class="kn">import</span> <span class="nn">time</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">plain</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
   <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>You can specify where the task should run within the recipe‚Äôs task list by using the
<em>before</em> and <em>after</em> keywords.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addtask</span> <span class="n">custom_task</span> <span class="n">after</span> <span class="n">do_fetch</span> <span class="n">before</span> <span class="n">do_compile</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The task you are adding doesn‚Äôt need the the <em>do_</em> prefix, but the tasks specified
by <em>before</em> and <em>after</em> need the <em>do_</em> prefix to be registered correctly.</p>
</div>
<p>From the python task you can print various levels of information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bb</span><span class="o">.</span><span class="n">plain</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">bb</span><span class="o">.</span><span class="n">note</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">)</span>
<span class="n">bb</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Oh no a warning&quot;</span><span class="p">)</span>
<span class="n">bb</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Oh no an error!!!&quot;</span><span class="p">)</span>
<span class="n">bb</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Crash and burn&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can look into <em>log.taskorder</em> to check the order of tasks</p>
</div>
</section>
<section id="package-groups">
<h2>Package Groups<a class="headerlink" href="#package-groups" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>A package group is a group of packages (recipes) that achieve the same/similar things.</p>
<section id="adding-a-package-group">
<h3>Adding a package group<a class="headerlink" href="#adding-a-package-group" title="Permalink to this heading">ÔÉÅ</a></h3>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Example in a <em>packagegroup-custom.bb</em> file</span><a class="headerlink" href="#id3" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PACKAGE_ARCH = &quot;${MACHINE_ARCH}&quot;

inherit packagegroup

PACKAGES = &quot;\
   ${PN}-helloworld \
&quot;

RDEPENDS:${PN}-helloworld = &quot; \
   hello \
&quot;
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">${PN}</span></code> is ‚Äòpackagegroup-custom‚Äô, or the package name. You can have multiple
images included in the <code class="docutils literal notranslate"><span class="pre">RDEPENDS</span></code> section.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Example including package-group in <em>.bb</em> file</span><a class="headerlink" href="#id4" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IMAGE_INSTALL</span> <span class="o">+=</span> <span class="s2">&quot; packagegroup-custom-helloworld&quot;</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="making-your-own-distro">
<h2>Making your own Distro<a class="headerlink" href="#making-your-own-distro" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>To make your own distro, you will need to create a new layer. In this layer,
create a file in <em>conf/distro</em> called <em>&lt;my_distro&gt;.conf</em>.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Example distro.conf file, based on the Poky distro</span><a class="headerlink" href="#id5" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">require</span> <span class="n">conf</span><span class="o">/</span><span class="n">distro</span><span class="o">/</span><span class="n">poky</span><span class="o">.</span><span class="n">conf</span>

<span class="n">DISTRO_NAME</span> <span class="o">=</span> <span class="s2">&quot;mydistro&quot;</span>
<span class="n">DISTRO_VERSION</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
</pre></div>
</div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">DISTRO</span> <span class="pre">?=</span> <span class="pre">&quot;mydistro&quot;</span></code> to your <em>local.conf</em> to implement your distro.</p>
</section>
<section id="systemd">
<h2>SystemD<a class="headerlink" href="#systemd" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>If you want to use SystemD instead of Sysvinit, you can add the following lines to distro
configuration file.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Example addition to Distro config file</span><a class="headerlink" href="#id6" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DISTRO_FEATURES</span><span class="p">:</span><span class="n">append</span> <span class="o">=</span> <span class="s2">&quot; systemd&quot;</span>
<span class="n">DISTRO_FEATURES</span><span class="p">:</span><span class="n">remove</span> <span class="o">=</span> <span class="s2">&quot;sysvinit&quot;</span>
<span class="n">VIRTUAL</span><span class="o">-</span><span class="n">RUNTIME_init_manager</span> <span class="o">=</span> <span class="s2">&quot;systemd&quot;</span>
<span class="n">DISTRO_FEATURES_BACKFILL_CONSIDERED</span> <span class="o">=</span> <span class="s2">&quot;sysvinit&quot;</span>
<span class="n">VIRTUAL</span><span class="o">-</span><span class="n">RUNTIME_initscripts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<section id="adding-a-service">
<h3>Adding a Service<a class="headerlink" href="#adding-a-service" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul>
<li><p>Create a new layer:</p>
<blockquote>
<div><dl class="simple">
<dt>::</dt><dd><dl class="simple">
<dt>‚îî‚îÄ‚îÄ systemd</dt><dd><p>‚îú‚îÄ‚îÄ files
‚îÇ   ‚îî‚îÄ‚îÄ hello.service
‚îî‚îÄ‚îÄ hellosystemd.bb</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</li>
<li><p>In the <em>.bb</em> file, you‚Äôll want something like this:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LICENSE = &quot;CLOSED&quot;
inherit systemd

SYSTEMD_AUTO_ENABLE = &quot;enable&quot;
SYSTEMD_SERVICE:${PN} = &quot;hello.service&quot;

SRC_URI:append = &quot; file://hello.service &quot;
FILES:${PN} += &quot;${systemd_unitdir}/system/hello.service&quot;

do_install:append() {
install -d ${D}/${systemd_unitdir}/system
install -m 0644 ${WORKDIR}/hello.service ${D}/${systemd_unitdir}/system
}
</pre></div>
</div>
<ul class="simple">
<li><p>In the service file, you specify your service config. Here we specify what program
this service runs and to print to the standard output</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">GNU</span> <span class="n">Hello</span> <span class="n">World</span> <span class="n">startup</span> <span class="n">script</span> <span class="k">for</span> <span class="n">KOAN</span> <span class="n">training</span> <span class="n">course</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">hellocmake</span>
<span class="n">StandardOutput</span><span class="o">=</span><span class="n">tty</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<ul>
<li><p>Inlude it in your final image, with <em>IMAGE_INSTALL_append</em> or add it to a package group</p>
<blockquote>
<div><p>e.g. <code class="docutils literal notranslate"><span class="pre">IMAGE_INSTALL:append</span> <span class="pre">=</span> <span class="pre">&quot;</span> <span class="pre">hellosystemd&quot;</span></code> added to <em>layer.conf</em></p>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="patch-files">
<h2>Patch Files<a class="headerlink" href="#patch-files" title="Permalink to this heading">ÔÉÅ</a></h2>
<p><a class="reference external" href="https://www.youtube.com/watch?v=srM6u8e4tyw&amp;list=PLEBQazB0HUyTpoJoZecRK6PpDG31Y7RPB&amp;index=6">Example patch of device tree</a>.</p>
<p>The basic idea of a patch is that you create a diff file for the file you want to patch.
The name of the patch file doesn‚Äôt matter too much. The file it targets is named within the file.
There are some conventions though of the naming of patch files that you can look up.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Example creating a diff file</span><a class="headerlink" href="#id7" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>diff<span class="w"> </span>--no-index<span class="w"> </span>socfpga_common.h.orig<span class="w"> </span>socfpga_common.h<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0001</span>-add-uboot-bootcmd.patch
</pre></div>
</div>
</div>
<p>The patch is applied by including it in the SRC variable. Yocto/Bitbake automatically
will search for and apply patch files.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Adding the patch file</span><a class="headerlink" href="#id8" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FILESEXTRAPATHS:prepend<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">THISDIR</span><span class="si">}</span><span class="s2">:&quot;</span>
<span class="nv">SRC_URI</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;file://0001-add-uboot-bootcmd.patch&quot;</span>
</pre></div>
</div>
</div>
<p>This could go in a <em>.bbappend</em> file, pointing to the recipe which fetches the source
you want to patch.</p>
<p>In Bitbake, the workflow of tasks is like this:</p>
<ol class="arabic simple">
<li><p>Fetch - get the source code</p></li>
<li><p>Extract - unpack the sources</p></li>
<li><p>Patch - apply patches for bug fixes and new capability</p></li>
<li><p>Configure - set up your environment specifications</p></li>
<li><p>Build - compile and link</p></li>
<li><p>Install - copy files to target directories</p></li>
<li><p>Package - bundle files for installation</p></li>
</ol>
<section id="patching-device-tree">
<h3>Patching Device Tree<a class="headerlink" href="#patching-device-tree" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Device tree files are .dtsi and .dts files. .dtsi files are include files, and are used generally. .dts
files are the ones that are used in the end, so these are the ones you want to patch if working on device tree.
Device tree also have a function to override certain attributes, by using a reference to the device tree tag.
This example updates the watchdog0 node to have status okay:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Example overriding status attribute</span><a class="headerlink" href="#id9" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-dts notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">watchdog0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<p>You can find more info <a class="reference external" href="https://www.devicetree.org/">here</a> about device trees.</p>
</section>
</section>
<section id="editing-bitbake-files">
<h2>Editing Bitbake Files<a class="headerlink" href="#editing-bitbake-files" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="assigning-values">
<h3>Assigning Values<a class="headerlink" href="#assigning-values" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul>
<li><p>Soft assignment: value is only assigned if not already, it can be overriden later
by a hard assignment</p>
<p><code class="docutils literal notranslate"><span class="pre">IMAGE_ROOTFS_SIZE</span> <span class="pre">?=</span> <span class="pre">&quot;204800&quot;</span></code></p>
</li>
<li><p>Hard assignment: Cannot be overriden</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">IMAGE_ROOTFS_SIZE</span> <span class="pre">=</span> <span class="pre">&quot;204800&quot;</span></code></p>
</div></blockquote>
</li>
</ul>
</section>
<section id="adding-packages">
<h3>Adding Packages<a class="headerlink" href="#adding-packages" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>You can add packages to the final image by using: <code class="docutils literal notranslate"><span class="pre">IMAGE_INSTALL</span> <span class="pre">+=</span> <span class="pre">&lt;package_name&gt;</span></code></p>
<p>The package could also be a package_group, with a list of packages to be installed.</p>
</section>
<section id="include-and-require">
<h3>Include and Require<a class="headerlink" href="#include-and-require" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>You can include some more info in your <em>.bb</em> files. You can either use include - which includes
the file in your <em>.bb file</em> - or require - which will check the file
exists first before processing the <em>.bb</em> file. If the file doesn‚Äôt
exist require will throw an error.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">require</span> <span class="n">recipes</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">hello</span><span class="o">-</span><span class="n">extend</span><span class="o">.</span><span class="n">bb</span>
</pre></div>
</div>
</section>
<section id="avoiding-recipe-name-clashes">
<h3>Avoiding recipe name clashes<a class="headerlink" href="#avoiding-recipe-name-clashes" title="Permalink to this heading">ÔÉÅ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BBFILE_PRIORITY_custom</span> <span class="o">=</span> <span class="s2">&quot;6&quot;</span>
</pre></div>
</div>
<p>This can be assinged in the <em>conf/layer.conf</em> file. The higher the number,
the higher the priority. This helps resolve cases where two recipes have the same
name.</p>
</section>
<section id="using-python">
<h3>Using Python<a class="headerlink" href="#using-python" title="Permalink to this heading">ÔÉÅ</a></h3>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Example removing ‚Äò-frename-registers‚Äô from CFLAGS</span><a class="headerlink" href="#id10" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CFLAGS</span> <span class="o">:=</span> <span class="s2">&quot;${@&#39;$</span><span class="si">{CFLAGS}</span><span class="s2">&#39;.replace(&#39;-frename-registers&#39;, &#39;&#39;)}&quot;</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol allows you to use python within an expression</p>
<p>You can also use python functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">do_compile</span><span class="p">(){</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">plain</span><span class="p">(</span><span class="s2">&quot;Hello from Python&quot;</span><span class="p">)</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">note</span><span class="p">(</span><span class="s2">&quot;Hello from a note&quot;</span><span class="p">)</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Hello from a warn&quot;</span><span class="p">)</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Hello from a error&quot;</span><span class="p">)</span>
   <span class="n">bb</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Hello from a fatal&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="optomising-image-size">
<h3>Optomising Image Size<a class="headerlink" href="#optomising-image-size" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Turning on buildhistory will help track parameters we can tweak</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INHERIT</span> <span class="o">+=</span> <span class="s2">&quot; buildhistory&quot;</span>
<span class="n">BUILDHISTORY_COMMIT</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>This turns on buildhistory and allows it be version controlled.
There will be some useful files like: image_info.txt, depends.dot, installed-package-sizes.txt</p>
<p>Use these to help you determine which packages you can remove:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IMAGE_INSTALL_remove</span> <span class="o">+=</span> <span class="s2">&quot; &lt;package_name&gt;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-sdk">
<h2>Creating an SDK<a class="headerlink" href="#creating-an-sdk" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>An SDK (Software Development Kit) provides all the utilities for building and compiling
software for a target.</p>
<p>There is an SDK <em>bbclass</em> in the poky classes-recipes directory. It can be included in your
build by using: <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">populate-sdk</span></code></p>
<p>This will create files in <em>build/tmp/deploy/sdk</em> where you can run a script to install on your machine.</p>
<p>An example of using an SDK after it is installed is given here. This sources the environment
variables which will point to the correct tools and environment variables to build
software for your target.</p>
<p><code class="code highlight bash docutils literal highlight-bash">.<span class="w"> </span>/opt/poky/4.1.3/environment-setup-cortexa9t2hf-neon-poky-linux-gnueabi</code></p>
</section>
<section id="recipe-naming">
<h2>Recipe Naming<a class="headerlink" href="#recipe-naming" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Recipes are built using their name. They can optionally include a version number
at the end of their name, e.g. <code class="docutils literal notranslate"><span class="pre">my_recipe_0.1.bb</span></code></p>
<p>You can reference specific recipe versions or take the latest by using just the name.</p>
<p>You can make append files and other files ignore the version of the recipe too by using the
<code class="docutils literal notranslate"><span class="pre">%</span></code> symbol. e.g. <code class="docutils literal notranslate"><span class="pre">my_recipe_%.bbappend</span></code> will apply to all versions of <code class="docutils literal notranslate"><span class="pre">my_recipe</span></code></p>
</section>
<section id="updating-bitbake-syntax">
<h2>Updating Bitbake Syntax<a class="headerlink" href="#updating-bitbake-syntax" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Bitbake has changed it syntax recently so sometimes if you copy something that uses the
old syntax bitbake will throw an error.</p>
<p>There is a script that helps update old syntax:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>poky
scripts/contrib/convert-overrides.py<span class="w"> </span>&lt;your-layer&gt;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pytest.html" class="btn btn-neutral float-left" title="PyTest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="uboot.html" class="btn btn-neutral float-right" title="U-Boot" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mikkel Caschetto-Bottcher.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>